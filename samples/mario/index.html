<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8">
  <title>FunScript - Mario - Playing Mario with HTML5 Canvas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="
    FunScript consists of a standalone F# to JavaScript compiler library and a Type Provider to TypeScript.       
    FunScript lets you connect to client and server APIs with Intellisense and types automagically using
    F# 3's Type Provider mechanism.">
  <meta name="author" content="Zach Bray">

  <!-- Reference Foundation -->
  <link rel="stylesheet" href="http://funscript.info/css/foundation.css" />
  <script src="http://funscript.info/js/vendor/custom.modernizr.js"></script>

  <!-- Reference custom CSS and tooltips -->
  <link type="text/css" rel="stylesheet" href="http://funscript.info/custom/style.css" />
  <script src="http://funscript.info/custom/tooltips.js" type="text/javascript"></script>
  <link type="text/css" rel="stylesheet" href="http://funscript.info/custom/tooltips.css" />
</head>
<body>

  <!-- Header bar with name and navigation links -->
  <nav class="top-bar">
    <ul class="title-area">
      <li class="name"><h1><a href="http://funscript.info">FunScript</a></h1></li>
      <li class="toggle-topbar"><a href="#"><span>Menu</span></a></li>
    </ul>

    <section class="top-bar-section">
      <ul class="left">
        <li><a href="http://funscript.info/index.html">home</a></li>
        <li><a href="http://funscript.info/learn.html">learn more</a></li>
        <li><a href="http://funscript.info/get.html">get started</a></li>
        <li><a href="http://funscript.info/contribute.html">contribute</a></li>
      </ul>
    </section>
  </nav>

  <header>
    <div class="row">
      <div class="twelve columns">
        <h1>Mario</h1>
        <h3>Playing Mario with HTML5 Canvas</h3>
      </div>
    </div>
  </header>

  <!-- Some more Foundation references (always load jQuery, because samples use it) -->
  <script src="http://funscript.info/js/vendor/jquery.js"></script>
  <script src="http://funscript.info/js/foundation.min.js"></script>  
  <script src="http://funscript.info/js/foundation/foundation.reveal.js"></script>
  <script>
    $(document).foundation();
  </script>
  
  <!-- Some references the samples might need. TODO: Import these ,e.g., {sample-scripts}. -->
  <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
  <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
  <script src="http://code.highcharts.com/highcharts.js"></script>
  
  <!-- Foundation dialog that appears when "Open Sample"  is clicked -->
  <div id="sampleDialog" class="reveal-modal medium" style="width:580px">
    <h2>Playing Mario with HTML5 Canvas</h2>
    
  <div>
    <canvas id="canvas" width="512" height="384" style="position:absolute;"></canvas>
    <img id="image" src="#" style="position:absolute;" >
  </div>
  
    <a class="close-reveal-modal">&#215;</a>
  </div>

	<div class="row">
    <div class="large-9 columns">
      <p>Mario game sample, based on functional reactive <a href="http://elm-lang.org/edit/examples/Intermediate/Mario.elm">Elm script</a>.
The F# version is using HTML 5 canvas to render the background and an <code>img</code>
tag showing the Mario (using animated GIFs). To play the game, click the "Open sample"
button on the right and use keyboard keys to play!</p>

<h2>Mario step</h2>

<p>We keep information about Mario in a single record type with fields that 
represent the current x and y coordinates (<code>x</code> and <code>y</code>), current velocity
(<code>vx</code> and <code>vy</code>) and the current direction <code>dir</code>. The direction is used to
pick the correct Mario image when rendering:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Mario</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">x</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">float</span>; <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">y</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">float</span>; <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">vx</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="i">float</span>; <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="i">vy</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 9)" onmouseover="showTip(event, 'fs3', 9)" class="i">float</span>; <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">dir</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">string</span> }</pre>
</td>
</tr>
</table><p>The step function of the game takes previvous <code>Mario</code> value and returns a new 
one. It is composed from 4 functions that represent different aspects of the game.</p>

<p>The functions that depend on keyboard take the current keyboard state as the 
first argument. This is represented as a tuple <code>int*int</code> consisting of x and y
directions. For example, when the left key is pressed, the value is <code>(-1, 0)</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// If the Up key is pressed (y &gt; 0) and Mario is on the ground, </span>
<span class="c">// then create Mario with the y velocity &#39;vy&#39; set to 5</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">jump</span> (_,<span onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13)" class="i">y</span>) <span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">m</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs10', 15)" onmouseover="showTip(event, 'fs10', 15)" class="i">y</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs11', 16)" onmouseover="showTip(event, 'fs11', 16)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 17)" onmouseover="showTip(event, 'fs4', 17)" class="i">y</span> <span class="o">=</span> <span class="n">0.</span> <span class="k">then</span>  { <span onmouseout="hideTip(event, 'fs11', 18)" onmouseover="showTip(event, 'fs11', 18)" class="i">m</span> <span class="k">with</span> <span class="i">vy</span> <span class="o">=</span> <span class="n">5.</span> } <span class="k">else</span> <span onmouseout="hideTip(event, 'fs11', 19)" onmouseover="showTip(event, 'fs11', 19)" class="i">m</span>
<span class="c">// If Mario is in the air, then his &quot;up&quot; velocity is decreasing</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="i">gravity</span> <span onmouseout="hideTip(event, 'fs11', 21)" onmouseover="showTip(event, 'fs11', 21)" class="i">m</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs11', 22)" onmouseover="showTip(event, 'fs11', 22)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 23)" onmouseover="showTip(event, 'fs4', 23)" class="i">y</span> <span class="o">&gt;</span> <span class="n">0.</span> <span class="k">then</span> { <span onmouseout="hideTip(event, 'fs11', 24)" onmouseover="showTip(event, 'fs11', 24)" class="i">m</span> <span class="k">with</span> <span class="i">vy</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 25)" onmouseover="showTip(event, 'fs11', 25)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 26)" onmouseover="showTip(event, 'fs6', 26)" class="i">vy</span> <span class="o">-</span> <span class="n">0.1</span> } <span class="k">else</span> <span onmouseout="hideTip(event, 'fs11', 27)" onmouseover="showTip(event, 'fs11', 27)" class="i">m</span>
<span class="c">// Apply physics - move Mario according to the current velocities</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 28)" onmouseover="showTip(event, 'fs13', 28)" class="i">physics</span> <span onmouseout="hideTip(event, 'fs11', 29)" onmouseover="showTip(event, 'fs11', 29)" class="i">m</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs11', 30)" onmouseover="showTip(event, 'fs11', 30)" class="i">m</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs2', 31)" onmouseover="showTip(event, 'fs2', 31)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 32)" onmouseover="showTip(event, 'fs11', 32)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 33)" onmouseover="showTip(event, 'fs2', 33)" class="i">x</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs11', 34)" onmouseover="showTip(event, 'fs11', 34)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 35)" onmouseover="showTip(event, 'fs5', 35)" class="i">vx</span>; <span onmouseout="hideTip(event, 'fs4', 36)" onmouseover="showTip(event, 'fs4', 36)" class="i">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 37)" onmouseover="showTip(event, 'fs14', 37)" class="i">max</span> <span class="n">0.</span> (<span onmouseout="hideTip(event, 'fs11', 38)" onmouseover="showTip(event, 'fs11', 38)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 39)" onmouseover="showTip(event, 'fs4', 39)" class="i">y</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs11', 40)" onmouseover="showTip(event, 'fs11', 40)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 41)" onmouseover="showTip(event, 'fs6', 41)" class="i">vy</span>) }
<span class="c">// When Left or Right keys are pressed, change the &#39;vx&#39; velocity and direction</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 42)" onmouseover="showTip(event, 'fs15', 42)" class="i">walk</span> (<span onmouseout="hideTip(event, 'fs16', 43)" onmouseover="showTip(event, 'fs16', 43)" class="i">x</span>,_) <span onmouseout="hideTip(event, 'fs11', 44)" onmouseover="showTip(event, 'fs11', 44)" class="i">m</span> <span class="o">=</span> 
    { <span onmouseout="hideTip(event, 'fs11', 45)" onmouseover="showTip(event, 'fs11', 45)" class="i">m</span> <span class="k">with</span> <span class="i">vx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 46)" onmouseover="showTip(event, 'fs3', 46)" class="i">float</span> <span onmouseout="hideTip(event, 'fs16', 47)" onmouseover="showTip(event, 'fs16', 47)" class="i">x</span> 
             <span class="i">dir</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs16', 48)" onmouseover="showTip(event, 'fs16', 48)" class="i">x</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">then</span> <span class="s">&quot;</span><span class="s">left</span><span class="s">&quot;</span> <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs16', 49)" onmouseover="showTip(event, 'fs16', 49)" class="i">x</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="s">&quot;</span><span class="s">right</span><span class="s">&quot;</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs11', 50)" onmouseover="showTip(event, 'fs11', 50)" class="i">m</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 51)" onmouseover="showTip(event, 'fs7', 51)" class="i">dir</span> }</pre>
</td>
</tr>
</table><p>The <code>step</code> function takes a <code>dir</code> parameter representing the keyboard status
and a current <code>Mario</code> state. It simply runs 4 components in a pipeline:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 52)" onmouseover="showTip(event, 'fs17', 52)" class="i">step</span> <span onmouseout="hideTip(event, 'fs18', 53)" onmouseover="showTip(event, 'fs18', 53)" class="i">dir</span> <span onmouseout="hideTip(event, 'fs19', 54)" onmouseover="showTip(event, 'fs19', 54)" class="i">mario</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 55)" onmouseover="showTip(event, 'fs19', 55)" class="i">mario</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 56)" onmouseover="showTip(event, 'fs13', 56)" class="i">physics</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 57)" onmouseover="showTip(event, 'fs15', 57)" class="i">walk</span> <span onmouseout="hideTip(event, 'fs18', 58)" onmouseover="showTip(event, 'fs18', 58)" class="i">dir</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 59)" onmouseover="showTip(event, 'fs12', 59)" class="i">gravity</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs9', 60)" onmouseover="showTip(event, 'fs9', 60)" class="i">jump</span> <span onmouseout="hideTip(event, 'fs18', 61)" onmouseover="showTip(event, 'fs18', 61)" class="i">dir</span></pre>
</td>
</tr>
</table><h2>Rendering Mario</h2>

<p>Now we're ready to render Mario using HTML 5 canvas! To do that, we need the 
width and height of the canvas and the current state of Mario. The following
function fills the bottom half of the canvas with green, upper half with blue
and then chooses the right Mario image:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Render mario on canvas </span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 62)" onmouseover="showTip(event, 'fs20', 62)" class="i">render</span> (<span onmouseout="hideTip(event, 'fs21', 63)" onmouseover="showTip(event, 'fs21', 63)" class="i">w</span>,<span onmouseout="hideTip(event, 'fs22', 64)" onmouseover="showTip(event, 'fs22', 64)" class="i">h</span>) (<span onmouseout="hideTip(event, 'fs19', 65)" onmouseover="showTip(event, 'fs19', 65)" class="i">mario</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs1', 66)" onmouseover="showTip(event, 'fs1', 66)" class="i">Mario</span>) <span class="o">=</span>
    <span class="c">// Render background</span>
    (<span class="n">0.</span>, <span class="n">0.</span>, <span onmouseout="hideTip(event, 'fs21', 67)" onmouseover="showTip(event, 'fs21', 67)" class="i">w</span>, <span onmouseout="hideTip(event, 'fs22', 68)" onmouseover="showTip(event, 'fs22', 68)" class="i">h</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 69)" onmouseover="showTip(event, 'fs23', 69)" class="i">filled</span> (<span onmouseout="hideTip(event, 'fs24', 70)" onmouseover="showTip(event, 'fs24', 70)" class="i">rgb</span> <span class="n">174</span> <span class="n">238</span> <span class="n">238</span>)
    (<span class="n">0.</span>, <span onmouseout="hideTip(event, 'fs22', 71)" onmouseover="showTip(event, 'fs22', 71)" class="i">h</span><span class="o">-</span><span class="n">50.</span>, <span onmouseout="hideTip(event, 'fs21', 72)" onmouseover="showTip(event, 'fs21', 72)" class="i">w</span>, <span class="n">50.</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 73)" onmouseover="showTip(event, 'fs23', 73)" class="i">filled</span> (<span onmouseout="hideTip(event, 'fs24', 74)" onmouseover="showTip(event, 'fs24', 74)" class="i">rgb</span> <span class="n">74</span> <span class="n">163</span> <span class="n">41</span>)
    <span class="c">// Select and position Mario</span>
    <span class="c">// (walking is represented as an animated gif)</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 75)" onmouseover="showTip(event, 'fs25', 75)" class="i">verb</span> <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs19', 76)" onmouseover="showTip(event, 'fs19', 76)" class="i">mario</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 77)" onmouseover="showTip(event, 'fs4', 77)" class="i">y</span> <span class="o">&gt;</span> <span class="n">0.</span> <span class="k">then</span> <span class="s">&quot;</span><span class="s">jump</span><span class="s">&quot;</span>
        <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs19', 78)" onmouseover="showTip(event, 'fs19', 78)" class="i">mario</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 79)" onmouseover="showTip(event, 'fs5', 79)" class="i">vx</span> <span class="o">&lt;&gt;</span> <span class="n">0.</span> <span class="k">then</span> <span class="s">&quot;</span><span class="s">walk</span><span class="s">&quot;</span>
        <span class="k">else</span> <span class="s">&quot;</span><span class="s">stand</span><span class="s">&quot;</span>
    <span class="s">&quot;</span><span class="s">mario</span><span class="s">&quot;</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs25', 80)" onmouseover="showTip(event, 'fs25', 80)" class="i">verb</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs19', 81)" onmouseover="showTip(event, 'fs19', 81)" class="i">mario</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 82)" onmouseover="showTip(event, 'fs7', 82)" class="i">dir</span> <span class="o">+</span> <span class="s">&quot;</span><span class="s">.</span><span class="s">gif</span><span class="s">&quot;</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 83)" onmouseover="showTip(event, 'fs26', 83)" class="i">image</span> 
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs27', 84)" onmouseover="showTip(event, 'fs27', 84)" class="i">position</span> (<span onmouseout="hideTip(event, 'fs21', 85)" onmouseover="showTip(event, 'fs21', 85)" class="i">w</span><span class="o">/</span><span class="n">2.</span><span class="o">-</span><span class="n">16.</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs19', 86)" onmouseover="showTip(event, 'fs19', 86)" class="i">mario</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 87)" onmouseover="showTip(event, 'fs2', 87)" class="i">x</span>,  <span onmouseout="hideTip(event, 'fs22', 88)" onmouseover="showTip(event, 'fs22', 88)" class="i">h</span><span class="o">-</span><span class="n">50.</span><span class="o">-</span><span class="n">31.</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs19', 89)" onmouseover="showTip(event, 'fs19', 89)" class="i">mario</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 90)" onmouseover="showTip(event, 'fs4', 90)" class="i">y</span>)</pre>
</td>
</tr>
</table><h2>Driving the game</h2>

<p>The last thing that needs to be done is to write the <code>main</code> function that drives
the game. The function does some initialization and then starts a recursive <code>update</code> 
function that calculates a new game state using <code>step</code> and renders it in a loop:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 91)" onmouseover="showTip(event, 'fs28', 91)" class="i">main</span>() <span class="o">=</span>
  <span class="c">// Some initialization</span>
  <span onmouseout="hideTip(event, 'fs29', 92)" onmouseover="showTip(event, 'fs29', 92)" class="i">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 93)" onmouseover="showTip(event, 'fs30', 93)" class="i">init</span>()
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 94)" onmouseover="showTip(event, 'fs21', 94)" class="i">w</span>,<span onmouseout="hideTip(event, 'fs22', 95)" onmouseover="showTip(event, 'fs22', 95)" class="i">h</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs31', 96)" onmouseover="showTip(event, 'fs31', 96)" class="i">dimensions</span>()
  <span class="c">// Recursive function that updates the state &amp; renders it</span>
  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs32', 97)" onmouseover="showTip(event, 'fs32', 97)" class="i">update</span> <span onmouseout="hideTip(event, 'fs19', 98)" onmouseover="showTip(event, 'fs19', 98)" class="i">mario</span> () <span class="o">=</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 99)" onmouseover="showTip(event, 'fs19', 99)" class="i">mario</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 100)" onmouseover="showTip(event, 'fs19', 100)" class="i">mario</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs17', 101)" onmouseover="showTip(event, 'fs17', 101)" class="i">step</span> (<span onmouseout="hideTip(event, 'fs29', 102)" onmouseover="showTip(event, 'fs29', 102)" class="i">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 103)" onmouseover="showTip(event, 'fs33', 103)" class="i">arrows</span>())
      <span onmouseout="hideTip(event, 'fs20', 104)" onmouseover="showTip(event, 'fs20', 104)" class="i">render</span> (<span onmouseout="hideTip(event, 'fs21', 105)" onmouseover="showTip(event, 'fs21', 105)" class="i">w</span>,<span onmouseout="hideTip(event, 'fs22', 106)" onmouseover="showTip(event, 'fs22', 106)" class="i">h</span>) <span onmouseout="hideTip(event, 'fs19', 107)" onmouseover="showTip(event, 'fs19', 107)" class="i">mario</span>      
      <span onmouseout="hideTip(event, 'fs34', 108)" onmouseover="showTip(event, 'fs34', 108)" class="i">Globals</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 109)" onmouseover="showTip(event, 'fs35', 109)" class="i">setTimeout</span>(<span onmouseout="hideTip(event, 'fs32', 110)" onmouseover="showTip(event, 'fs32', 110)" class="i">update</span> <span onmouseout="hideTip(event, 'fs19', 111)" onmouseover="showTip(event, 'fs19', 111)" class="i">mario</span>, <span class="n">1000.</span> <span class="o">/</span> <span class="n">60.</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs36', 112)" onmouseover="showTip(event, 'fs36', 112)" class="i">ignore</span>
  <span class="c">// Start the game with Mario in the center</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 113)" onmouseover="showTip(event, 'fs19', 113)" class="i">mario</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs2', 114)" onmouseover="showTip(event, 'fs2', 114)" class="i">x</span><span class="o">=</span><span class="n">0.</span>; <span onmouseout="hideTip(event, 'fs4', 115)" onmouseover="showTip(event, 'fs4', 115)" class="i">y</span><span class="o">=</span><span class="n">0.</span>; <span class="i">vx</span><span class="o">=</span><span class="n">0.</span>; <span class="i">vy</span><span class="o">=</span><span class="n">0.</span>; <span class="i">dir</span><span class="o">=</span><span class="s">&quot;</span><span class="s">right</span><span class="s">&quot;</span> }
  <span onmouseout="hideTip(event, 'fs32', 116)" onmouseover="showTip(event, 'fs32', 116)" class="i">update</span> <span onmouseout="hideTip(event, 'fs19', 117)" onmouseover="showTip(event, 'fs19', 117)" class="i">mario</span> ()
   </pre>
</td>
</tr>
</table>
      <div class="tip" id="fs1">type Mario =<br />&#160;&#160;{x: float;<br />&#160;&#160;&#160;y: float;<br />&#160;&#160;&#160;vx: float;<br />&#160;&#160;&#160;vy: float;<br />&#160;&#160;&#160;dir: string;}<br /><br />Full name: Program.Mario</div>
<div class="tip" id="fs2">Mario.x: float</div>
<div class="tip" id="fs3">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs4">Mario.y: float</div>
<div class="tip" id="fs5">Mario.vx: float</div>
<div class="tip" id="fs6">Mario.vy: float</div>
<div class="tip" id="fs7">Mario.dir: string</div>
<div class="tip" id="fs8">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs9">val jump : &#39;a * y:int -&gt; m:Mario -&gt; Mario<br /><br />Full name: Program.jump</div>
<div class="tip" id="fs10">val y : int</div>
<div class="tip" id="fs11">val m : Mario</div>
<div class="tip" id="fs12">val gravity : m:Mario -&gt; Mario<br /><br />Full name: Program.gravity</div>
<div class="tip" id="fs13">val physics : m:Mario -&gt; Mario<br /><br />Full name: Program.physics</div>
<div class="tip" id="fs14">val max : e1:&#39;T -&gt; e2:&#39;T -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.Operators.max</div>
<div class="tip" id="fs15">val walk : x:int * &#39;a -&gt; m:Mario -&gt; Mario<br /><br />Full name: Program.walk</div>
<div class="tip" id="fs16">val x : int</div>
<div class="tip" id="fs17">val step : int * int -&gt; mario:Mario -&gt; Mario<br /><br />Full name: Program.step</div>
<div class="tip" id="fs18">val dir : int * int</div>
<div class="tip" id="fs19">val mario : Mario</div>
<div class="tip" id="fs20">val render : w:float * h:float -&gt; mario:Mario -&gt; unit<br /><br />Full name: Program.render<br /><em><br /><br />&#160;Render mario on canvas </em></div>
<div class="tip" id="fs21">val w : float</div>
<div class="tip" id="fs22">val h : float</div>
<div class="tip" id="fs23">val filled : color:&#39;a -&gt; float * float * float * float -&gt; unit<br /><br />Full name: Program.Window.filled</div>
<div class="tip" id="fs24">val rgb : r:&#39;a -&gt; g:&#39;b -&gt; b:&#39;c -&gt; string<br /><br />Full name: Program.Window.rgb</div>
<div class="tip" id="fs25">val verb : string</div>
<div class="tip" id="fs26">val image : src:string -&gt; HTMLImageElement<br /><br />Full name: Program.Window.image</div>
<div class="tip" id="fs27">val position : x:&#39;a * y:float -&gt; img:HTMLImageElement -&gt; unit<br /><br />Full name: Program.Window.position</div>
<div class="tip" id="fs28">val main : unit -&gt; unit<br /><br />Full name: Program.main</div>
<div class="tip" id="fs29">module Keyboard<br /><br />from Program<br /><em><br /><br />&#160;Handles keydown and keyup events of the window and exposes them<br />&#160;using the &#39;arrows&#39; property (which is a tuple int*int with -1 if the<br />&#160;left/up key is pressed, 1 if right/down key is pressed and 0 otherwise)</em></div>
<div class="tip" id="fs30">val init : unit -&gt; unit<br /><br />Full name: Program.Keyboard.init</div>
<div class="tip" id="fs31">val dimensions : unit -&gt; float * float<br /><br />Full name: Program.Window.dimensions</div>
<div class="tip" id="fs32">val update : (Mario -&gt; unit -&gt; unit)</div>
<div class="tip" id="fs33">val arrows : unit -&gt; int * int<br /><br />Full name: Program.Keyboard.arrows</div>
<div class="tip" id="fs34">type Globals<br /><br />Full name: FunScript.TypeScript.Globals</div>
<div class="tip" id="fs35">static member Globals.setTimeout : handler:obj * ?timeout:obj -&gt; float<br />static member Globals.setTimeout : handler:obj * timeout:obj * params args:obj array -&gt; float</div>
<div class="tip" id="fs36">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>

    </div>
    <div class="large-3 columns">

      <h3>Live demo</h3>
      <p>Click here to open the sample live, running using JavaScript in a dialog window.</p>

      <div style="margin-left:auto;margin-right:auto;text-align:center;">
      <div id="run-button">
			  <a data-reveal-id="sampleDialog" href="#" class="success button">Open sample</a>
  		</div>
      </div>

      <p>To look at the generated JavaScript, view the source of this web page
        and scroll to the end of the file.</p>

      <h3>Tutorials</h3>
      <p>Learn FunScript from the following introductory tutorials</p>
      <ul>
        <li><a href="../tutorial/index.html">Getting started tutorial</a></li>
        <li><a href="../mario/index.html">Mario Game using HTML5</a></li>
        <li><a href="../simpleasync/index.html">Asynchornous computations</a></li>
        <li><a href="../canvas/index.html">Using HTML5 canvas</a></li>
      </ul>

      <h3>Samples</h3>
      <p>Browse other amazing samples created with FunScript</p>
      <ul>
        <li><a href="../pacman/index.html">Pacman using HTML5 Canvas</a></li>
        <li><a href="../worldbank/index.html">Visualizing World Bank data</a></li>
        <li><a href="../moviedatabase/index.html">Calling The Movie Database</a></li>
      </ul>
    </div>
	</div>

  <div class="row"><div class="large-12 columns" id="footer">
    FunScript is open-source project available under Apache 2.0 &#160; | &#160;  <a href="http://fsharp.org">The F# Software Foundation</a>
  </div></div>

  <!-- Fork me on GitHub link -->
  <a href="https://github.com/ZachBray/FunScript"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
   

  
  <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-36398955-2', 'funscript.info');
	  ga('send', 'pageview');
  </script>

  <!-- JavaScript code from the sample goes here... -->
  <script type="text/javascript">
    $(document).ready(function () {
var Window__rgb$Int32__Int32__Int32_Int32_Int32_Int32, Window__position$Double_Double, Window__op_Dollar$String_String, Window__op_Dollar$Int32_Int32, Window__image$, Window__get_context$, Window__get_canvas$, Window__filled$String_String, Window__dimensions$, Window__context, Window__canvas, TupleSetTree_1_Int32__SetTree_1_Int32_, TupleInt32_SetTree_1_Int32_, TupleInt32_Int32, TupleDouble_Double_Double_Double, TupleDouble_Double, Set__Remove$Int32_Int32, Set__Empty$Int32_Int32, Set__Add$Int32_Int32, Set_1_Int32__get_Tree$Int32, Set_1_Int32__get_Empty$Int32, Set_1_Int32__get_Comparer$Int32, Set_1_Int32___ctor$Int32, Set_1_Int32__Remove$Int32, Set_1_Int32__Add$Int32, Set_1_IComparable__get_Tree$IComparable_, Set_1_IComparable__get_Comparer$IComparable_, Set_1_IComparable__Contains$IComparable_, SetTree_1_Int32__SetOneInt32, SetTree_1_Int32__SetNodeInt32, SetTree_1_Int32__SetEmptyInt32, SetTreeModule__tolerance, SetTreeModule__spliceOutSuccessor$Int32_Int32, SetTreeModule__remove$Int32_Int32, SetTreeModule__rebalance$Int32_Int32, SetTreeModule__mk$Int32_Int32, SetTreeModule__mem$IComparable_IComparable_, SetTreeModule__height$Int32_Int32, SetTreeModule__get_tolerance$, SetTreeModule__add$Int32_Int32, SetTreeModule__SetOne$Int32_Int32, SetTreeModule__SetNode$Int32_Int32, Program__walk$Int32_Int32, Program__step$, Program__render$, Program__physics$, Program__main$, Program__jump$Int32_Int32, Program__gravity$, Mario___ctor$, Lazy_1_Object__get_Value$Object_, Lazy_1_Object___ctor$Object_, Lazy_1_Object__Create$Object_, Keyboard__update$, Keyboard__keysPressed, Keyboard__init$, Keyboard__get_keysPressed$, Keyboard__code$, Keyboard__arrows$, GenericComparer_1_Int32___ctor$Int32;
  GenericComparer_1_Int32___ctor$Int32 = (function (unitVar0)
  {
    ;
  });
  Keyboard__arrows$ = (function (unitVar0)
  {
    return (new TupleInt32_Int32((Keyboard__code$(39) - Keyboard__code$(37)), (Keyboard__code$(38) - Keyboard__code$(40))));
  });
  Keyboard__code$ = (function (x)
  {
    if (Set_1_IComparable__Contains$IComparable_(Keyboard__keysPressed, x)) 
    {
      return 1;
    }
    else
    {
      return 0;
    };
  });
  Keyboard__get_keysPressed$ = (function ()
  {
    return Set__Empty$Int32_Int32();
  });
  Keyboard__init$ = (function (unitVar0)
  {
    (window.addEventListener("keydown", (function (e)
    {
      Keyboard__update$(e, true);
      return null;
    })));
    return (window.addEventListener("keyup", (function (e)
    {
      Keyboard__update$(e, false);
      return null;
    })));
  });
  Keyboard__update$ = (function (e, pressed)
  {
    var keyCode = (e.keyCode);
    var _7;
    if (pressed) 
    {
      _7 = (function (value)
      {
        return (function (set)
        {
          return Set__Add$Int32_Int32(value, set);
        });
      });
    }
    else
    {
      _7 = (function (value)
      {
        return (function (set)
        {
          return Set__Remove$Int32_Int32(value, set);
        });
      });
    };
    var op = _7;
    Keyboard__keysPressed = op(keyCode)(Keyboard__keysPressed);
  });
  Lazy_1_Object__Create$Object_ = (function (f)
  {
    return (new Lazy_1_Object___ctor$Object_(null, f));
  });
  Lazy_1_Object___ctor$Object_ = (function (value, factory)
  {
    this.factory = factory;
    this.isCreated = false;
    this.value_25 = value;
  });
  Lazy_1_Object__get_Value$Object_ = (function (x, unitVar1)
  {
    if ((!x.isCreated)) 
    {
      var _391;
      var _394;
      _391 = x.factory(_394);
      x.value_25 = _391;
      x.isCreated = true;
    }
    else
    {
      ;
    };
    return x.value_25;
  });
  Mario___ctor$ = (function (x, y, vx, vy, dir)
  {
    this.x = x;
    this.y = y;
    this.vx = vx;
    this.vy = vy;
    this.dir = dir;
  });
  Mario___ctor$.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.x < that.x) ? -1.000000 : ((this.x == that.x) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = ((this.y < that.y) ? -1.000000 : ((this.y == that.y) ? 0.000000 : 1.000000));
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        var ___diff = 0.000000;
        ___diff = ((this.vx < that.vx) ? -1.000000 : ((this.vx == that.vx) ? 0.000000 : 1.000000));
        diff = ___diff;
        if ((diff != 0.000000)) 
        {
          return diff;
        }
        else
        {
          var ____diff = 0.000000;
          ____diff = ((this.vy < that.vy) ? -1.000000 : ((this.vy == that.vy) ? 0.000000 : 1.000000));
          diff = ____diff;
          if ((diff != 0.000000)) 
          {
            return diff;
          }
          else
          {
            var _____diff = 0.000000;
            _____diff = ((this.dir < that.dir) ? -1.000000 : ((this.dir == that.dir) ? 0.000000 : 1.000000));
            diff = _____diff;
            if ((diff != 0.000000)) 
            {
              return diff;
            }
            else
            {
              return 0.000000;
            };
          };
        };
      };
    };
  });
  Program__gravity$ = (function (m)
  {
    if ((m.y > 0.000000)) 
    {
      var vy = (m.vy - 0.100000);
      return (new Mario___ctor$(m.x, m.y, m.vx, vy, m.dir));
    }
    else
    {
      return m;
    };
  });
  Program__jump$Int32_Int32 = (function (_arg1, y, m)
  {
    if (((y > 0) && (m.y == 0.000000))) 
    {
      var vy = 5.000000;
      return (new Mario___ctor$(m.x, m.y, m.vx, vy, m.dir));
    }
    else
    {
      return m;
    };
  });
  Program__main$ = (function (unitVar0)
  {
    Keyboard__init$();
    var patternInput = Window__dimensions$();
    var w = patternInput.Items[0.000000];
    var h = patternInput.Items[1.000000];
    var update;
    update = (function (mario)
    {
      return (function (unitVar1)
      {
        var _417;
        var _418;
        var tupledArg = Keyboard__arrows$();
        var arg00_ = tupledArg.Items[0.000000];
        var arg01_ = tupledArg.Items[1.000000];
        _418 = (function (_mario)
        {
          return Program__step$(arg00_, arg01_, _mario);
        });
        _417 = _418(mario);
        var _mario = _417;
        Program__render$(w, h, _mario);
        return (function (value)
        {
          var ignored0 = value;
        })((window.setTimeout(update(_mario), (1000.000000 / 60.000000))));
      });
    });
    var mario = (new Mario___ctor$(0.000000, 0.000000, 0.000000, 0.000000, "right"));
    var _415;
    return update(mario)(_415);
  });
  Program__physics$ = (function (m)
  {
    var _586;
    if (((m.y + m.vy) > 0.000000)) 
    {
      _586 = (m.y + m.vy);
    }
    else
    {
      _586 = 0.000000;
    };
    return (new Mario___ctor$((m.x + m.vx), _586, m.vx, m.vy, m.dir));
  });
  Program__render$ = (function (w, h, mario)
  {
    var _616;
    var color = Window__rgb$Int32__Int32__Int32_Int32_Int32_Int32(174, 238, 238);
    _616 = (function (tupledArg)
    {
      var arg10_ = tupledArg.Items[0.000000];
      var arg11_ = tupledArg.Items[1.000000];
      var arg12_ = tupledArg.Items[2.000000];
      var arg13_ = tupledArg.Items[3.000000];
      return Window__filled$String_String(color, arg10_, arg11_, arg12_, arg13_);
    });
    _616((new TupleDouble_Double_Double_Double(0.000000, 0.000000, w, h)));
    var _688;
    var _color = Window__rgb$Int32__Int32__Int32_Int32_Int32_Int32(74, 163, 41);
    _688 = (function (tupledArg)
    {
      var arg10_ = tupledArg.Items[0.000000];
      var arg11_ = tupledArg.Items[1.000000];
      var arg12_ = tupledArg.Items[2.000000];
      var arg13_ = tupledArg.Items[3.000000];
      return Window__filled$String_String(_color, arg10_, arg11_, arg12_, arg13_);
    });
    _688((new TupleDouble_Double_Double_Double(0.000000, (h - 50.000000), w, 50.000000)));
    var _713;
    if ((mario.y > 0.000000)) 
    {
      _713 = "jump";
    }
    else
    {
      if ((mario.vx != 0.000000)) 
      {
        _713 = "walk";
      }
      else
      {
        _713 = "stand";
      };
    };
    var verb = _713;
    var _724;
    var tupledArg = (new TupleDouble_Double((((w / 2.000000) - 16.000000) + mario.x), (((h - 50.000000) - 31.000000) - mario.y)));
    var x = tupledArg.Items[0.000000];
    var y = tupledArg.Items[1.000000];
    _724 = (function (img)
    {
      return Window__position$Double_Double(x, y, img);
    });
    return _724((function (src)
    {
      return Window__image$(src);
    })(((("mario" + verb) + mario.dir) + ".gif")));
  });
  Program__step$ = (function (dir_0, dir_1, mario)
  {
    var dir = (new TupleInt32_Int32(dir_0, dir_1));
    var _489;
    var arg00_ = dir.Items[0.000000];
    var y = dir.Items[1.000000];
    _489 = (function (m)
    {
      return Program__jump$Int32_Int32(arg00_, y, m);
    });
    var _519;
    var _545;
    var _546;
    var x = dir.Items[0.000000];
    var arg01_ = dir.Items[1.000000];
    _546 = (function (m)
    {
      return Program__walk$Int32_Int32(x, arg01_, m);
    });
    _545 = _546((function (m)
    {
      return Program__physics$(m);
    })(mario));
    _519 = (function (m)
    {
      return Program__gravity$(m);
    })(_545);
    return _489(_519);
  });
  Program__walk$Int32_Int32 = (function (x, _arg1, m)
  {
    var vx = x;
    var _556;
    if ((x < 0)) 
    {
      _556 = "left";
    }
    else
    {
      if ((x > 0)) 
      {
        _556 = "right";
      }
      else
      {
        _556 = m.dir;
      };
    };
    var dir = _556;
    return (new Mario___ctor$(m.x, m.y, vx, m.vy, dir));
  });
  SetTreeModule__SetNode$Int32_Int32 = (function (x, l, r, h)
  {
    return (new SetTree_1_Int32__SetNodeInt32(x, l, r, h));
  });
  SetTreeModule__SetOne$Int32_Int32 = (function (n)
  {
    return (new SetTree_1_Int32__SetOneInt32(n));
  });
  SetTreeModule__add$Int32_Int32 = (function (comparer, k, t)
  {
    if ((t.Tag == 2.000000)) 
    {
      var k2 = t.Item;
      var c = comparer.Compare(k, k2);
      if ((c < 0)) 
      {
        return SetTreeModule__SetNode$Int32_Int32(k, (new SetTree_1_Int32__SetEmptyInt32()), t, 2);
      }
      else
      {
        if ((c == 0)) 
        {
          return t;
        }
        else
        {
          return SetTreeModule__SetNode$Int32_Int32(k, t, (new SetTree_1_Int32__SetEmptyInt32()), 2);
        };
      };
    }
    else
    {
      if ((t.Tag == 0.000000)) 
      {
        return SetTreeModule__SetOne$Int32_Int32(k);
      }
      else
      {
        var r = t.Item3;
        var l = t.Item2;
        var _k2 = t.Item1;
        var _c = comparer.Compare(k, _k2);
        if ((_c < 0)) 
        {
          return SetTreeModule__rebalance$Int32_Int32(SetTreeModule__add$Int32_Int32(comparer, k, l), _k2, r);
        }
        else
        {
          if ((_c == 0)) 
          {
            return t;
          }
          else
          {
            return SetTreeModule__rebalance$Int32_Int32(l, _k2, SetTreeModule__add$Int32_Int32(comparer, k, r));
          };
        };
      };
    };
  });
  SetTreeModule__get_tolerance$ = (function ()
  {
    return 2;
  });
  SetTreeModule__height$Int32_Int32 = (function (t)
  {
    if ((t.Tag == 2.000000)) 
    {
      return 1;
    }
    else
    {
      if ((t.Tag == 1.000000)) 
      {
        var h = t.Item4;
        return h;
      }
      else
      {
        return 0;
      };
    };
  });
  SetTreeModule__mem$IComparable_IComparable_ = (function (comparer, k, t)
  {
    if ((t.Tag == 2.000000)) 
    {
      var k2 = t.Item;
      return (comparer.Compare(k, k2) == 0);
    }
    else
    {
      if ((t.Tag == 0.000000)) 
      {
        return false;
      }
      else
      {
        var r = t.Item3;
        var l = t.Item2;
        var _k2 = t.Item1;
        var c = comparer.Compare(k, _k2);
        if ((c < 0)) 
        {
          return SetTreeModule__mem$IComparable_IComparable_(comparer, k, l);
        }
        else
        {
          return ((c == 0) || SetTreeModule__mem$IComparable_IComparable_(comparer, k, r));
        };
      };
    };
  });
  SetTreeModule__mk$Int32_Int32 = (function (l, k, r)
  {
    var matchValue = (new TupleSetTree_1_Int32__SetTree_1_Int32_(l, r));
    if ((matchValue.Items[0.000000].Tag == 0.000000)) 
    {
      if ((matchValue.Items[1.000000].Tag == 0.000000)) 
      {
        return SetTreeModule__SetOne$Int32_Int32(k);
      }
      else
      {
        var hl = SetTreeModule__height$Int32_Int32(l);
        var hr = SetTreeModule__height$Int32_Int32(r);
        var _140;
        if ((hl < hr)) 
        {
          _140 = hr;
        }
        else
        {
          _140 = hl;
        };
        var m = _140;
        return SetTreeModule__SetNode$Int32_Int32(k, l, r, (m + 1));
      };
    }
    else
    {
      var _hl = SetTreeModule__height$Int32_Int32(l);
      var _hr = SetTreeModule__height$Int32_Int32(r);
      var _154;
      if ((_hl < _hr)) 
      {
        _154 = _hr;
      }
      else
      {
        _154 = _hl;
      };
      var _m = _154;
      return SetTreeModule__SetNode$Int32_Int32(k, l, r, (_m + 1));
    };
  });
  SetTreeModule__rebalance$Int32_Int32 = (function (t1, k, t2)
  {
    var t1h = SetTreeModule__height$Int32_Int32(t1);
    var t2h = SetTreeModule__height$Int32_Int32(t2);
    if ((t2h > (t1h + SetTreeModule__tolerance))) 
    {
      if ((t2.Tag == 1.000000)) 
      {
        var t2r = t2.Item3;
        var t2l = t2.Item2;
        var t2k = t2.Item1;
        if ((SetTreeModule__height$Int32_Int32(t2l) > (t1h + 1))) 
        {
          if ((t2l.Tag == 1.000000)) 
          {
            var t2lr = t2l.Item3;
            var t2ll = t2l.Item2;
            var t2lk = t2l.Item1;
            return SetTreeModule__mk$Int32_Int32(SetTreeModule__mk$Int32_Int32(t1, k, t2ll), t2lk, SetTreeModule__mk$Int32_Int32(t2lr, t2k, t2r));
          }
          else
          {
            throw ("rebalance");
            return null;
          };
        }
        else
        {
          return SetTreeModule__mk$Int32_Int32(SetTreeModule__mk$Int32_Int32(t1, k, t2l), t2k, t2r);
        };
      }
      else
      {
        throw ("rebalance");
        return null;
      };
    }
    else
    {
      if ((t1h > (t2h + SetTreeModule__tolerance))) 
      {
        if ((t1.Tag == 1.000000)) 
        {
          var t1r = t1.Item3;
          var t1l = t1.Item2;
          var t1k = t1.Item1;
          if ((SetTreeModule__height$Int32_Int32(t1r) > (t2h + 1))) 
          {
            if ((t1r.Tag == 1.000000)) 
            {
              var t1rr = t1r.Item3;
              var t1rl = t1r.Item2;
              var t1rk = t1r.Item1;
              return SetTreeModule__mk$Int32_Int32(SetTreeModule__mk$Int32_Int32(t1l, t1k, t1rl), t1rk, SetTreeModule__mk$Int32_Int32(t1rr, k, t2));
            }
            else
            {
              throw ("rebalance");
              return null;
            };
          }
          else
          {
            return SetTreeModule__mk$Int32_Int32(t1l, t1k, SetTreeModule__mk$Int32_Int32(t1r, k, t2));
          };
        }
        else
        {
          throw ("rebalance");
          return null;
        };
      }
      else
      {
        return SetTreeModule__mk$Int32_Int32(t1, k, t2);
      };
    };
  });
  SetTreeModule__remove$Int32_Int32 = (function (comparer, k, t)
  {
    if ((t.Tag == 2.000000)) 
    {
      var k2 = t.Item;
      var c = comparer.Compare(k, k2);
      if ((c == 0)) 
      {
        return (new SetTree_1_Int32__SetEmptyInt32());
      }
      else
      {
        return t;
      };
    }
    else
    {
      if ((t.Tag == 1.000000)) 
      {
        var r = t.Item3;
        var l = t.Item2;
        var _k2 = t.Item1;
        var _c = comparer.Compare(k, _k2);
        if ((_c < 0)) 
        {
          return SetTreeModule__rebalance$Int32_Int32(SetTreeModule__remove$Int32_Int32(comparer, k, l), _k2, r);
        }
        else
        {
          if ((_c == 0)) 
          {
            var matchValue = (new TupleSetTree_1_Int32__SetTree_1_Int32_(l, r));
            if ((matchValue.Items[0.000000].Tag == 0.000000)) 
            {
              return r;
            }
            else
            {
              if ((matchValue.Items[1.000000].Tag == 0.000000)) 
              {
                return l;
              }
              else
              {
                var patternInput = SetTreeModule__spliceOutSuccessor$Int32_Int32(r);
                var sk = patternInput.Items[0.000000];
                var r_ = patternInput.Items[1.000000];
                return SetTreeModule__mk$Int32_Int32(l, sk, r_);
              };
            };
          }
          else
          {
            return SetTreeModule__rebalance$Int32_Int32(l, _k2, SetTreeModule__remove$Int32_Int32(comparer, k, r));
          };
        };
      }
      else
      {
        return t;
      };
    };
  });
  SetTreeModule__spliceOutSuccessor$Int32_Int32 = (function (t)
  {
    if ((t.Tag == 2.000000)) 
    {
      var k2 = t.Item;
      return (new TupleInt32_SetTree_1_Int32_(k2, (new SetTree_1_Int32__SetEmptyInt32())));
    }
    else
    {
      if ((t.Tag == 1.000000)) 
      {
        var r = t.Item3;
        var l = t.Item2;
        var _k2 = t.Item1;
        if ((l.Tag == 0.000000)) 
        {
          return (new TupleInt32_SetTree_1_Int32_(_k2, r));
        }
        else
        {
          var patternInput = SetTreeModule__spliceOutSuccessor$Int32_Int32(l);
          var l_ = patternInput.Items[1.000000];
          var k3 = patternInput.Items[0.000000];
          return (new TupleInt32_SetTree_1_Int32_(k3, SetTreeModule__mk$Int32_Int32(l_, _k2, r)));
        };
      }
      else
      {
        throw ("internal error: Map.spliceOutSuccessor");
        return null;
      };
    };
  });
  SetTree_1_Int32__SetEmptyInt32 = (function ()
  {
    this.Tag = 0.000000;
    this._CaseName = "SetEmpty";
  });
  SetTree_1_Int32__SetEmptyInt32.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.Tag < that.Tag) ? -1.000000 : ((this.Tag == that.Tag) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      return 0.000000;
    };
  });
  SetTree_1_Int32__SetNodeInt32 = (function (Item1, Item2, Item3, Item4)
  {
    this.Tag = 1.000000;
    this._CaseName = "SetNode";
    this.Item1 = Item1;
    this.Item2 = Item2;
    this.Item3 = Item3;
    this.Item4 = Item4;
  });
  SetTree_1_Int32__SetNodeInt32.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.Tag < that.Tag) ? -1.000000 : ((this.Tag == that.Tag) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = ((this.Item1 < that.Item1) ? -1.000000 : ((this.Item1 == that.Item1) ? 0.000000 : 1.000000));
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        var ___diff = 0.000000;
        ___diff = this.Item2.CompareTo(that.Item2);
        diff = ___diff;
        if ((diff != 0.000000)) 
        {
          return diff;
        }
        else
        {
          var ____diff = 0.000000;
          ____diff = this.Item3.CompareTo(that.Item3);
          diff = ____diff;
          if ((diff != 0.000000)) 
          {
            return diff;
          }
          else
          {
            var _____diff = 0.000000;
            _____diff = ((this.Item4 < that.Item4) ? -1.000000 : ((this.Item4 == that.Item4) ? 0.000000 : 1.000000));
            diff = _____diff;
            if ((diff != 0.000000)) 
            {
              return diff;
            }
            else
            {
              return 0.000000;
            };
          };
        };
      };
    };
  });
  SetTree_1_Int32__SetOneInt32 = (function (Item)
  {
    this.Tag = 2.000000;
    this._CaseName = "SetOne";
    this.Item = Item;
  });
  SetTree_1_Int32__SetOneInt32.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.Tag < that.Tag) ? -1.000000 : ((this.Tag == that.Tag) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = ((this.Item < that.Item) ? -1.000000 : ((this.Item == that.Item) ? 0.000000 : 1.000000));
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        return 0.000000;
      };
    };
  });
  Set_1_IComparable__Contains$IComparable_ = (function (s, x)
  {
    return SetTreeModule__mem$IComparable_IComparable_(Set_1_IComparable__get_Comparer$IComparable_(s), x, Set_1_IComparable__get_Tree$IComparable_(s));
  });
  Set_1_IComparable__get_Comparer$IComparable_ = (function (set, unitVar1)
  {
    return set.comparer_479;
  });
  Set_1_IComparable__get_Tree$IComparable_ = (function (set, unitVar1)
  {
    return set.tree_483;
  });
  Set_1_Int32__Add$Int32 = (function (s, x)
  {
    return (new Set_1_Int32___ctor$Int32(Set_1_Int32__get_Comparer$Int32(s), SetTreeModule__add$Int32_Int32(Set_1_Int32__get_Comparer$Int32(s), x, Set_1_Int32__get_Tree$Int32(s))));
  });
  Set_1_Int32__Remove$Int32 = (function (s, x)
  {
    return (new Set_1_Int32___ctor$Int32(Set_1_Int32__get_Comparer$Int32(s), SetTreeModule__remove$Int32_Int32(Set_1_Int32__get_Comparer$Int32(s), x, Set_1_Int32__get_Tree$Int32(s))));
  });
  Set_1_Int32___ctor$Int32 = (function (comparer, tree)
  {
    this.comparer_479 = comparer;
    this.tree_483 = tree;
    this.serializedData = null;
  });
  Set_1_Int32__get_Comparer$Int32 = (function (set, unitVar1)
  {
    return set.comparer_479;
  });
  Set_1_Int32__get_Empty$Int32 = (function (unitVar0)
  {
    var comparer = (new GenericComparer_1_Int32___ctor$Int32());
    var _362;
    var impl;
    impl = comparer;
    _362 = {Compare: (function (x, y)
    {
      return (function (__, x, y)
      {
        var diff = 0.000000;
        diff = ((x < y) ? -1.000000 : ((x == y) ? 0.000000 : 1.000000));
        return diff;
      })(impl, x, y);
    })};
    return (new Set_1_Int32___ctor$Int32(_362, (new SetTree_1_Int32__SetEmptyInt32())));
  });
  Set_1_Int32__get_Tree$Int32 = (function (set, unitVar1)
  {
    return set.tree_483;
  });
  Set__Add$Int32_Int32 = (function (x, s)
  {
    return Set_1_Int32__Add$Int32(s, x);
  });
  Set__Empty$Int32_Int32 = (function ()
  {
    return Set_1_Int32__get_Empty$Int32();
  });
  Set__Remove$Int32_Int32 = (function (x, s)
  {
    return Set_1_Int32__Remove$Int32(s, x);
  });
  TupleDouble_Double = (function (Item0, Item1)
  {
    this.Items = [Item0, Item1];
    this.Items = [Item0, Item1];
  });
  TupleDouble_Double.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.Items[0.000000] < that.Items[0.000000]) ? -1.000000 : ((this.Items[0.000000] == that.Items[0.000000]) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = ((this.Items[1.000000] < that.Items[1.000000]) ? -1.000000 : ((this.Items[1.000000] == that.Items[1.000000]) ? 0.000000 : 1.000000));
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        return 0.000000;
      };
    };
  });
  TupleDouble_Double_Double_Double = (function (Item0, Item1, Item2, Item3)
  {
    this.Items = [Item0, Item1, Item2, Item3];
    this.Items = [Item0, Item1, Item2, Item3];
    this.Items = [Item0, Item1, Item2, Item3];
    this.Items = [Item0, Item1, Item2, Item3];
  });
  TupleDouble_Double_Double_Double.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.Items[0.000000] < that.Items[0.000000]) ? -1.000000 : ((this.Items[0.000000] == that.Items[0.000000]) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = ((this.Items[1.000000] < that.Items[1.000000]) ? -1.000000 : ((this.Items[1.000000] == that.Items[1.000000]) ? 0.000000 : 1.000000));
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        var ___diff = 0.000000;
        ___diff = ((this.Items[2.000000] < that.Items[2.000000]) ? -1.000000 : ((this.Items[2.000000] == that.Items[2.000000]) ? 0.000000 : 1.000000));
        diff = ___diff;
        if ((diff != 0.000000)) 
        {
          return diff;
        }
        else
        {
          var ____diff = 0.000000;
          ____diff = ((this.Items[3.000000] < that.Items[3.000000]) ? -1.000000 : ((this.Items[3.000000] == that.Items[3.000000]) ? 0.000000 : 1.000000));
          diff = ____diff;
          if ((diff != 0.000000)) 
          {
            return diff;
          }
          else
          {
            return 0.000000;
          };
        };
      };
    };
  });
  TupleInt32_Int32 = (function (Item0, Item1)
  {
    this.Items = [Item0, Item1];
    this.Items = [Item0, Item1];
  });
  TupleInt32_Int32.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.Items[0.000000] < that.Items[0.000000]) ? -1.000000 : ((this.Items[0.000000] == that.Items[0.000000]) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = ((this.Items[1.000000] < that.Items[1.000000]) ? -1.000000 : ((this.Items[1.000000] == that.Items[1.000000]) ? 0.000000 : 1.000000));
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        return 0.000000;
      };
    };
  });
  TupleInt32_SetTree_1_Int32_ = (function (Item0, Item1)
  {
    this.Items = [Item0, Item1];
    this.Items = [Item0, Item1];
  });
  TupleInt32_SetTree_1_Int32_.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = ((this.Items[0.000000] < that.Items[0.000000]) ? -1.000000 : ((this.Items[0.000000] == that.Items[0.000000]) ? 0.000000 : 1.000000));
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = this.Items[1.000000].CompareTo(that.Items[1.000000]);
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        return 0.000000;
      };
    };
  });
  TupleSetTree_1_Int32__SetTree_1_Int32_ = (function (Item0, Item1)
  {
    this.Items = [Item0, Item1];
    this.Items = [Item0, Item1];
  });
  TupleSetTree_1_Int32__SetTree_1_Int32_.prototype.CompareTo = (function (that)
  {
    var diff = 0.000000;
    var _diff = 0.000000;
    _diff = this.Items[0.000000].CompareTo(that.Items[0.000000]);
    diff = _diff;
    if ((diff != 0.000000)) 
    {
      return diff;
    }
    else
    {
      var __diff = 0.000000;
      __diff = this.Items[1.000000].CompareTo(that.Items[1.000000]);
      diff = __diff;
      if ((diff != 0.000000)) 
      {
        return diff;
      }
      else
      {
        return 0.000000;
      };
    };
  });
  Window__dimensions$ = (function (unitVar0)
  {
    return (new TupleDouble_Double((Lazy_1_Object__get_Value$Object_(Window__canvas).width), (Lazy_1_Object__get_Value$Object_(Window__canvas).height)));
  });
  Window__filled$String_String = (function (color, rect_0, rect_1, rect_2, rect_3)
  {
    var rect = (new TupleDouble_Double_Double_Double(rect_0, rect_1, rect_2, rect_3));
    var ctx = Lazy_1_Object__get_Value$Object_(Window__context);
    (ctx.fillStyle) = color;
    null;
    return (function (tupledArg)
    {
      var arg00 = tupledArg.Items[0.000000];
      var arg01 = tupledArg.Items[1.000000];
      var arg02 = tupledArg.Items[2.000000];
      var arg03 = tupledArg.Items[3.000000];
      return (ctx.fillRect(arg00, arg01, arg02, arg03));
    })(rect);
  });
  Window__get_canvas$ = (function ()
  {
    return Lazy_1_Object__Create$Object_((function (unitVar)
    {
      return (((window.document).getElementsByTagName("canvas"))[0]);
    }));
  });
  Window__get_context$ = (function ()
  {
    return Lazy_1_Object__Create$Object_((function (unitVar)
    {
      return (Lazy_1_Object__get_Value$Object_(Window__canvas).getContext("2d"));
    }));
  });
  Window__image$ = (function (src)
  {
    var image = (((window.document).getElementsByTagName("img"))[0]);
    if (((image.src).indexOf(src) == -1)) 
    {
      (image.src) = src;
      null;
    }
    else
    {
      ;
    };
    return image;
  });
  Window__op_Dollar$Int32_Int32 = (function (s, n)
  {
    return (s + n.toString());
  });
  Window__op_Dollar$String_String = (function (s, n)
  {
    return (s + n.toString());
  });
  Window__position$Double_Double = (function (x, y, img)
  {
    ((img.style).left) = (x.toString() + "px");
    null;
    var _761;
    var _762;
    var copyOfStruct = ((Lazy_1_Object__get_Value$Object_(Window__canvas).offsetTop) + y);
    _762 = copyOfStruct.toString();
    _761 = (_762 + "px");
    var _773;
    var _774;
    var copyOfStruct = ((Lazy_1_Object__get_Value$Object_(Window__canvas).offsetTop) + y);
    _774 = copyOfStruct.toString();
    _773 = (_774 + "px");
    ((img.style).top) = _761;
    return null;
  });
  Window__rgb$Int32__Int32__Int32_Int32_Int32_Int32 = (function (r, g, b)
  {
    return Window__op_Dollar$String_String(Window__op_Dollar$Int32_Int32(Window__op_Dollar$String_String(Window__op_Dollar$Int32_Int32(Window__op_Dollar$String_String(Window__op_Dollar$Int32_Int32("rgb(", r), ","), g), ","), b), ")");
  });
  SetTreeModule__tolerance = SetTreeModule__get_tolerance$();
  Keyboard__keysPressed = Keyboard__get_keysPressed$();
  Window__canvas = Window__get_canvas$();
  Window__context = Window__get_context$();
  return Program__main$()
});
  </script>

</body>
</html>
